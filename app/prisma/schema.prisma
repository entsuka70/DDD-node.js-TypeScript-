// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model setupData {
    id String @id
    required Boolean
    number Int @db.SmallInt
}

model User {
    id Int @id @default(autoincrement())
    pair_id Int @default(1) /// 1:無所属, 2~:ペア所属
    user_name String
    email String @unique
    belong_id Int @default(1) /// 1:在籍中, 2:休会中, 3:退会済み
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    userIssue UserIssue[]
    belong Belong @relation(fields: [belong_id], references: [id])
    pair Pair @relation(fields: [pair_id], references: [id])
}

model Belong {
    id Int @id @default(autoincrement()) /// 1:在籍中, 2:休会中, 3:退会済み
    belong Int /// 1:在籍中, 2:休会中, 3:退会済み
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    user User[]
}

model UserIssue {
    id Int @id @default(autoincrement())
    user_id Int
    issue_id Int /// 1~80:課題種類
    progress Int @default(1) /// 1:未着手, 2:レビュー待ち, 3:完了
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    user User @relation(fields: [user_id], references: [id])
    issue Issue @relation(fields: [issue_id], references: [id])
}

model Issue {
    id Int @id @default(autoincrement()) /// 1~80:課題種類
    issue_name String
    issue_group_id Int @default(1) /// 1:未分類 2:WEBの基礎, 3:テスト, 4:DB, 5:設計
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    userIssue UserIssue[]
    issueGroup IssueGroup @relation(fields: [issue_group_id], references: [id])
}

model IssueGroup {
    id Int @id @default(autoincrement())
    issue_group Int @default(1) /// 1:未分類 2:WEBの基礎, 3:テスト, 4:DB, 5:設計
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt
    
    issue Issue[]
}

model Pair {
    id Int @id @default(autoincrement())
    pair_name String
    teams_id Int @default(1) /// 1:無所属, 2~:チーム所属
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    user User[]
    team Team @relation(fields: [teams_id], references: [id])
}

model Team {
    id Int @id @default(autoincrement()) /// 1:無所属 2~:チーム所属
    team_name String
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    pair Pair[]
}